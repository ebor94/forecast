# 📊 Guía Completa de Forecasting para Principiantes

## ¿Qué es Forecasting?
**Forecasting** = Predecir el futuro basándose en datos del pasado. Es como predecir cuánta lluvia habrá mañana basándote en el clima de los últimos días.

En nuestro caso: **Predecimos cuántos metros cuadrados de material comprará cada cliente el próximo mes**.

---

## 🔍 FUNCIÓN 1: `cargar_y_preparar_datos()`

### ¿Qué hace?
Toma tus datos "crudos" del CSV y los organiza para poder analizarlos.

### ¿Cómo funciona paso a paso?

1. **Lee el archivo CSV** con datos como:
   ```
   Cliente A | Material X | 150 M2 | Enero
   Cliente A | Material X | 200 M2 | Febrero  
   Cliente B | Material Y | 300 M2 | Enero
   ```

2. **Limpia los datos**:
   - Convierte "150,5" a 150.5 (números decimales)
   - Elimina filas con errores
   - Une fechas separadas (Año + Mes + Día)

3. **Agrupa por combinaciones**:
   - Suma todas las compras del "Cliente A + Material X" en cada mes
   - Cuenta cuántas transacciones hubo
   - Calcula promedios

### Resultado:
```
Cliente A | Material X | Enero | 350 M2 total | 3 transacciones
Cliente A | Material X | Febrero | 450 M2 total | 2 transacciones
```

**Analogía**: Es como organizar todas las facturas de tu negocio por cliente y producto para ver patrones.

---

## 🎯 FUNCIÓN 2: `identificar_combinaciones_predictibles()`

### ¿Qué hace?
Decide qué combinaciones Cliente+Material vale la pena predecir.

### ¿Qué es una "combinación predictible"?
Imagina que quieres predecir si va a llover:
- ✅ **Predictible**: Tienes datos de lluvia de los últimos 6 meses
- ❌ **No predictible**: Solo tienes datos de 1 día

### Criterios que usa:

1. **Mínimo 3 meses de datos**: 
   - ¿Por qué? Con menos datos es como predecir el clima con solo 1 día de información
   
2. **Mínimo 100 M2 totales**:
   - ¿Por qué? Clientes que compran muy poco (5 M2) son impredecibles

3. **Coeficiente de Variación (CV)**:
   - **¿Qué es?** Mide qué tan "estable" son las compras
   - **Fórmula**: CV = Desviación Estándar ÷ Promedio
   - **Ejemplo**:
     - Cliente A: compra 100, 110, 90 M2 → CV = 0.1 (estable)
     - Cliente B: compra 50, 200, 10 M2 → CV = 0.8 (impredecible)

4. **Score de Importancia**:
   - Combina volumen + estabilidad
   - Formula: `Volumen Total × (1 - CV) × Regularidad`
   - Prioriza clientes grandes y estables

**Analogía**: Es como elegir a qué amigos les prestas dinero. Prefieres a los que:
- Te han pedido prestado varias veces antes (datos históricos)
- Siempre te pagan cantidades similares (estabilidad)
- Te pagan montos significativos (volumen)

---

## 🔮 FUNCIÓN 3: `generar_forecast_combinacion()`

### ¿Qué hace?
Para cada Cliente+Material, predice cuánto comprará en los próximos 4 meses.

### ¿Cómo funciona?

#### Paso 1: Preparar Variables Predictoras
```python
# Variables básicas
periodo = [1, 2, 3, 4, 5]  # Enero=1, Febrero=2, etc.
mes_numero = [1, 2, 3, 4, 5]  # Para capturar estacionalidad

# Variables avanzadas (si hay datos suficientes)
media_movil = [promedio de últimos 3 meses]
indice_estacional = [si compra más en verano/invierno]
```

#### Paso 2: Seleccionar Modelo
- **Si tienes ≥6 meses de datos**: Usa **Random Forest**
  - ¿Por qué? Puede capturar patrones complejos
  - Ejemplo: "Este cliente siempre compra más después de 2 meses bajos"
  
- **Si tienes 3-5 meses**: Usa **Regresión Lineal**
  - ¿Por qué? Más simple, no se "confunde" con pocos datos
  - Ejemplo: "Este cliente aumenta 50 M2 cada mes"

#### Paso 3: Entrenar el Modelo
El modelo "aprende" patrones como:
- "Este cliente compra 200 M2 en enero, 180 en febrero, 220 en marzo..."
- "Parece que aumenta 10 M2 cada mes"
- "En verano compra 20% más"

#### Paso 4: Hacer Predicciones
Para cada mes futuro:
1. Calcula las variables (periodo, mes, etc.)
2. El modelo dice: "Basándome en el patrón, comprará X M2"
3. Se asegura que la predicción no sea negativa

### Métricas de Calidad:

**MAPE (Error Absoluto Porcentual Medio)**:
- **¿Qué es?** Qué tan cerca estuvieron las predicciones pasadas de la realidad
- **Fórmula**: `Promedio de |Real - Predicho| ÷ Real × 100`
- **Ejemplo**:
  - Real: 100 M2, Predicho: 90 M2 → Error = 10%
  - Real: 200 M2, Predicho: 220 M2 → Error = 10%
  - MAPE = 10%
- **Interpretación**:
  - 0-25%: Excelente 🟢
  - 25-50%: Bueno 🟡  
  - >50%: Revisar 🔴

**Analogía**: Es como predecir cuánto dinero gastarás en comida el próximo mes basándote en tus gastos pasados.

---

## 📊 FUNCIÓN 4: `ejecutar_forecast_completo()`

### ¿Qué hace?
Aplica la predicción a las top 100 combinaciones más importantes.

### ¿Por qué solo las top 100?
- **Principio de Pareto (80/20)**: 20% de clientes generan 80% de ventas
- Es más eficiente enfocarse en los importantes
- Evita ruido de clientes muy pequeños

### Proceso:
1. Toma las combinaciones ordenadas por importancia
2. Para cada una, ejecuta `generar_forecast_combinacion()`
3. Filtra resultados con MAPE >100% (demasiado imprecisos)
4. Ordena resultados por volumen predicho

**Analogía**: Es como un médico que atiende primero a los pacientes más graves.

---

## 📈 FUNCIÓN 5: `mostrar_resumen_ejecutivo()`

### ¿Qué hace?
Crea un "dashboard" o resumen ejecutivo con las métricas más importantes para tomar decisiones.

### Métricas que calcula:

#### 1. **Métricas Generales**:
```
• Combinaciones cliente-material: 847
• Clientes únicos: 156  
• M2 histórico total: 1,250,000
• M2 predicho total: 625,000
• Cambio vs promedio histórico: +15.3%
```

**¿Qué significa "Cambio vs promedio histórico"?**
- Histórico: 8 meses de datos = 1,250,000 ÷ 8 = 156,250 M2/mes promedio
- Predicho: 4 meses futuros = 625,000 ÷ 4 = 156,250 M2/mes promedio
- Si predicho > histórico → Crecimiento esperado
- Si predicho < histórico → Decrecimiento esperado

#### 2. **Top 10 Clientes**:
Muestra qué clientes comprarán más en los próximos 4 meses, con su porcentaje del total.

#### 3. **Top 10 Materiales**:
Qué productos tendrán más demanda.

#### 4. **Distribución de Precisión**:
```
• Excelente (<25% MAPE): 234 combinaciones (27.6%)
• Bueno (25-50% MAPE): 456 combinaciones (53.8%) 
• Revisar (>50% MAPE): 157 combinaciones (18.5%)
```

**Analogía**: Es como el reporte mensual de tu negocio que le presentas al jefe.

---

## 📊 FUNCIÓN 6: `generar_grafico_tendencias()`

### ¿Qué hace?
Crea gráficos visuales para entender mejor las predicciones.

### Gráficos que genera:

#### Gráfico 1: **Tendencias Individuales**
- Muestra las top 10 combinaciones
- Línea sólida = datos históricos
- Línea punteada = predicciones futuras
- Línea roja vertical = donde empiezan las predicciones

**¿Para qué sirve?**
Ver si las predicciones siguen la tendencia lógica o si hay saltos extraños.

#### Gráfico 2: **Comparativa Mensual Total**
- Barras azules = últimos 4 meses históricos
- Barras rojas = próximos 4 meses predichos
- Números encima = valores exactos

**¿Para qué sirve?**
Comparar si el volumen total predicho es similar al histórico.

**Analogía**: Es como hacer gráficos de tus gastos mensuales para ver patrones y planificar el presupuesto.

---

## 📋 FUNCIÓN 7: `generar_reporte_detallado()`

### ¿Qué hace?
Crea un reporte HTML completo (como una página web) con todas las predicciones en tablas.

### Secciones del reporte:

#### 1. **Cards Resumen**:
```
┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
│       847       │ │       156       │ │   1,250,000     │
│  Combinaciones  │ │    Clientes     │ │  M2 Histórico   │
└─────────────────┘ └─────────────────┘ └─────────────────┘
```

#### 2. **Tabla Detallada**:
Para cada combinación Cliente+Material muestra:
- Histórico total y promedio mensual
- MAPE (precisión) con colores
- Predicciones para Sep, Oct, Nov, Dic 2025
- Total predicho para 4 meses

#### 3. **Resumen por Cliente**:
Agrupa todos los materiales de cada cliente para ver su volumen total predicho.

**¿Por qué HTML y no solo Excel?**
- Colores automáticos según precisión
- Tablas interactivas
- Fácil de compartir por email
- Se ve profesional

**Analogía**: Es como crear un catálogo bonito de productos en lugar de solo una lista en papel.

---

## 📤 FUNCIÓN 8: `exportar_excel()`

### ¿Qué hace?
Convierte todas las predicciones a un archivo Excel para análisis posterior.

### Columnas que incluye:
```
| Cliente | Material | Total_Historico | Promedio_Mensual | MAPE | Septiembre_2025 | Octubre_2025 | ... |
```

### ¿Para qué usar Excel?
- Hacer filtros personalizados
- Crear gráficos propios
- Análisis de pivot tables
- Compartir con equipos que prefieren Excel

**Analogía**: Es como tener los datos en un formato que todos saben usar, como tener música en MP3 que funciona en cualquier reproductor.

---

## 📈 FUNCIÓN 9: `analisis_comparativo_clientes()`

### ¿Qué hace?
Analiza cada cliente por separado para entender su comportamiento.

### Métricas por cliente:

#### 1. **Número de Materiales**:
- Cliente A: compra 5 materiales diferentes
- Cliente B: compra 1 material
- **Insight**: Clientes que compran más variedad suelen ser más estables

#### 2. **Cambio vs Histórico**:
```
Cliente A: +15.3% (crecimiento esperado)
Cliente B: -8.2%  (decrecimiento esperado)
Cliente C: +0.5%  (estable)
```

#### 3. **MAPE Promedio**:
Qué tan predecible es cada cliente en general.

### ¿Para qué sirve?
- **Ventas**: Enfocar esfuerzos en clientes con crecimiento
- **Inventario**: Preparar stock para clientes grandes
- **Riesgo**: Identificar clientes con tendencia a la baja

**Analogía**: Es como analizar a cada uno de tus amigos para saber a quién invitar a diferentes tipos de eventos según sus gustos.

---

## 🤖 MODELOS DE MACHINE LEARNING EXPLICADOS

### 1. **Regresión Lineal**
**¿Qué hace?**
Encuentra la "mejor línea recta" que pase por tus datos históricos.

**Ejemplo simple**:
```
Mes 1: 100 M2
Mes 2: 110 M2  
Mes 3: 120 M2
Mes 4: 130 M2
```
El modelo dice: "Aumenta 10 M2 cada mes"
Predicción Mes 5: 140 M2

**¿Cuándo usarlo?**
- Pocos datos (3-5 meses)
- Patrones simples y lineales
- Cuando no queremos complicar

**Analogía**: Es como calcular a qué velocidad crece un niño midiendo su altura cada mes.

### 2. **Random Forest**
**¿Qué hace?**
Crea muchos "árboles de decisión" y promedia sus predicciones.

**¿Qué es un árbol de decisión?**
```
¿Es verano? 
├─ SÍ → ¿Compró >200 el mes pasado?
│   ├─ SÍ → Predice: 250 M2
│   └─ NO → Predice: 180 M2
└─ NO → ¿Es cliente grande?
    ├─ SÍ → Predice: 150 M2
    └─ NO → Predice: 80 M2
```

**Random Forest** = 100 árboles diferentes dan sus predicciones, se promedian.

**¿Cuándo usarlo?**
- Muchos datos (6+ meses)
- Patrones complejos
- Cuando hay estacionalidad

**Analogía**: Es como pedir opinión a 100 expertos y promediar sus respuestas.

---

## 📊 CONCEPTOS ESTADÍSTICOS IMPORTANTES

### 1. **Media Móvil**
**¿Qué es?**
Promedio de los últimos N períodos.

**Ejemplo**:
```
Enero: 100 M2
Febrero: 120 M2  
Marzo: 80 M2
Media móvil de 3 meses = (100 + 120 + 80) ÷ 3 = 100 M2
```

**¿Para qué sirve?**
Suavizar fluctuaciones y ver la tendencia real.

### 2. **Estacionalidad**
**¿Qué es?**
Patrones que se repiten en ciertos meses.

**Ejemplo**:
- Helados: Se venden más en verano
- Abrigos: Se venden más en invierno
- Materiales de construcción: Más en primavera

**¿Cómo se calcula?**
```
Índice estacional = Promedio del mes ÷ Promedio general

Si Enero promedio = 150 M2 y promedio general = 100 M2
Índice de Enero = 150 ÷ 100 = 1.5 (50% más que lo normal)
```

### 3. **Desviación Estándar**
**¿Qué es?**
Mide qué tan "esparcidos" están tus datos.

**Ejemplo**:
```
Cliente A: 100, 105, 95, 110, 90 M2 → Desviación baja (estable)
Cliente B: 50, 200, 10, 300, 5 M2 → Desviación alta (impredecible)
```

**Analogía**: Es como medir qué tan puntual es una persona. Alguien que llega siempre a las 9:00 ±5 min es predecible.

---

## 🎯 ¿CÓMO INTERPRETAR LOS RESULTADOS?

### 1. **Si MAPE < 25%** 🟢
- **Significado**: Predicciones muy confiables
- **Acción**: Usar para planificación de inventarios
- **Ejemplo**: Si predices 1000 M2, el real estará entre 750-1250 M2

### 2. **Si MAPE 25-50%** 🟡  
- **Significado**: Predicciones útiles pero con precaución
- **Acción**: Usar como guía, tener stock de seguridad
- **Ejemplo**: Si predices 1000 M2, el real estará entre 500-1500 M2

### 3. **Si MAPE > 50%** 🔴
- **Significado**: Predicciones poco confiables  
- **Acción**: Revisar datos, cliente muy irregular
- **Ejemplo**: La predicción puede estar completamente equivocada

### 4. **Cambio vs Histórico**
- **+15%**: Crecimiento esperado → Preparar más stock
- **-15%**: Decrecimiento esperado → Reducir pedidos
- **±5%**: Estabilidad → Mantener niveles actuales

---

## 🚨 LIMITACIONES Y CUIDADOS

### 1. **El pasado no siempre predice el futuro**
- Cambios en el mercado
- Crisis económicas  
- Nuevos competidores
- Cambios en el negocio del cliente

### 2. **Calidad de datos**
- Datos faltantes
- Errores en registros
- Cambios en criterios de medición

### 3. **Estacionalidad no capturada**
- Si solo tienes 8 meses, no ves el ciclo anual completo
- Eventos especiales (COVID, elecciones, etc.)

### 4. **Clientes nuevos**
- El modelo no puede predecir clientes sin historial
- Se necesita al menos 3 meses de datos

---

## 💡 CONSEJOS PRÁCTICOS

### Para Usar las Predicciones:
1. **Enfócate en las predicciones con MAPE <25%**
2. **Usa las predicciones como guía, no como verdad absoluta**
3. **Combina con tu conocimiento del negocio**
4. **Revisa mensualmente y ajusta**

### Para Mejorar las Predicciones:
1. **Recolecta más datos históricos**
2. **Mejora la calidad de los datos**
3. **Incluye variables externas (economía, clima)**
4. **Actualiza el modelo regularmente**

**Analogía Final**: El forecasting es como usar GPS para llegar a un destino. Te da la mejor ruta basada en información actual, pero si hay un accidente o construcción imprevista, necesitas ajustar el camino.